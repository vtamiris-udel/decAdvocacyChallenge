---
title: "Where Patrick Should Show Up"
subtitle: "A short plan to fix more cars each week"
format:
  html:
    theme: cosmo
    toc: false
execute:
  echo: false
  warning: false
  message: false
---

```{python}
#| label: setup
#| include: false
#| echo: false
import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt

sns.set_theme(style="whitegrid", palette="colorblind")

carsDF = pd.read_csv("/Users/venkattamirisa/Documents/certificate/course2/decAdvocacyChallenge/carsFixed.csv")
carsDF["boss_label"] = carsDF["boss"].map({0: "Boss away", 1: "Boss on site"})

shops = sorted(carsDF.shopID.unique())

absent_stats = carsDF[carsDF.boss == 0].groupby("shopID").carsFixed.agg(["mean", "std", "count"])
present_stats = carsDF[carsDF.boss == 1].groupby("shopID").carsFixed.agg(["mean", "std", "count"])

absent_mean = absent_stats["mean"]
present_mean = present_stats["mean"]
absent_days = absent_stats["count"]
present_days = present_stats["count"]
lift = present_mean - absent_mean

def bootstrap_diff(df, shop, n=3000, seed=1):
    rng = np.random.default_rng(seed)
    subset = df[df.shopID == shop]
    boss1 = subset[subset.boss == 1].carsFixed.values
    boss0 = subset[subset.boss == 0].carsFixed.values
    diffs = []
    for _ in range(n):
        s1 = rng.choice(boss1, size=len(boss1), replace=True)
        s0 = rng.choice(boss0, size=len(boss0), replace=True)
        diffs.append(s1.mean() - s0.mean())
    return np.percentile(diffs, [2.5, 97.5])

ci = {shop: bootstrap_diff(carsDF, shop) for shop in shops}

shop_table = pd.DataFrame({
    "Shop": shops,
    "Boss absent avg": absent_mean.reindex(shops).round(2).values,
    "Boss present avg": present_mean.reindex(shops).round(2).values,
    "Lift (cars/day)": lift.reindex(shops).round(2).values,
    "Lift 95% low": [ci[s][0] for s in shops],
    "Lift 95% high": [ci[s][1] for s in shops],
    "Boss-present days": present_days.reindex(shops).fillna(0).astype(int).values,
    "Boss-absent days": absent_days.reindex(shops).fillna(0).astype(int).values
})

overall_absent = carsDF[carsDF.boss == 0].carsFixed.mean()
overall_present = carsDF[carsDF.boss == 1].carsFixed.mean()

# Weekly scenarios assume a 5-day week where every shop operates daily.
baseline_week = sum(absent_mean[shop] * 5 for shop in shops)

def weekly_total(schedule):
    total = 0
    for shop in shops:
        present_days = schedule.get(shop, 0)
        total += present_days * present_mean.loc[shop]
        total += (5 - present_days) * absent_mean.loc[shop]
    return total

scenarios = {
    "Even rotation": {1: 1, 2: 1, 3: 1, 4: 1, 5: 1},
    "High-impact focus": {4: 2, 2: 1, 5: 1, 1: 1},
    "Brother-friendly": {4: 1, 2: 1, 3: 2, 5: 1}
}

scenario_rows = []
for name, sched in scenarios.items():
    total = weekly_total(sched)
    lift_week = total - baseline_week
    scenario_rows.append({
        "Scenario": name,
        "Expected cars/week": round(total, 1),
        "vs no visits": round(lift_week, 1)
    })
scenario_df = pd.DataFrame(scenario_rows)
```

# What we found (quick read)

- When Patrick shows up, productivity jumps about 9 more cars per day on average (38.5 vs 29.2).
- Biggest boosts show at Shop 4 (+12.8 cars/day) and Shop 2 (+10.1); Shop 5 and 1 also gain; Shop 3 is smaller and uncertain.
- A schedule that hits Shop 4 twice each week and Shops 2/5/1 once adds about 51 cars per week versus being away (about 10 more than evenly rotating).

# Data snapshot

- 250 workdays across 5 shops (50 days each).
- Patrick was on site 50 days total (5â€“15 days per shop); away 200 days.

```{python}
#| label: tbl-shop-stats
#| tbl-cap: "Output by shop with and without Patrick present"
#| echo: false
display_cols = ["Shop", "Boss absent avg", "Boss present avg", "Lift (cars/day)", "Lift 95% low", "Lift 95% high", "Boss-present days"]
shop_table[display_cols]
```

# All 250 days at a glance

```{python}
#| label: fig-all-points
#| fig-cap: "Every day of work, by shop and whether Patrick was on site"
#| echo: false
fig, ax = plt.subplots(figsize=(8, 4.5))
sns.stripplot(data=carsDF, x="shopID", y="carsFixed", hue="boss_label", jitter=0.25, dodge=True, alpha=0.65, ax=ax)
ax.set_xlabel("Shop")
ax.set_ylabel("Cars fixed per day")
ax.set_title("Patrick's presence generally lifts output")
ax.legend(title="Status", loc="upper left", bbox_to_anchor=(1.02, 1))
plt.tight_layout()
plt.show()
plt.close(fig)
```

# How much does Patrick move the needle?

```{python}
#| label: fig-lift-ci
#| fig-cap: "Boss effect by shop with 95% bootstrapped intervals"
#| echo: false
fig, ax = plt.subplots(figsize=(7, 4))
x = np.arange(len(shops))
lift_vals = shop_table["Lift (cars/day)"]
err_low = lift_vals - shop_table["Lift 95% low"]
err_high = shop_table["Lift 95% high"] - lift_vals
bars = ax.bar(x, lift_vals, color="#4C78A8", alpha=0.85, yerr=[err_low, err_high], capsize=6)
ax.axhline(0, color="gray", linewidth=1)
ax.set_xticks(x, [f"Shop {s}" for s in shops])
ax.set_ylabel("Extra cars/day when Patrick is on site")
ax.set_title("Effect varies by shop (wide bars where data are thin)")
plt.tight_layout()
plt.show()
plt.close(fig)
```

- Shops 4 and 2 pop the most (+13 and +10 cars/day). Caveat: only 5 boss-present days in each, so the band is wide.
- Shops 5 and 1 are solid movers (+8 and +7).
- Shop 3 shows a smaller lift (~+3) and its interval brushes zero; schedule it only if other priorities are covered or for personal reasons.

# Scheduling playbook (5-day week)

Assumption: all five shops run every weekday. Patrick chooses one shop per day; others run without him.

```{python}
#| label: tbl-scenarios
#| tbl-cap: "Projected weekly output under simple schedules"
#| echo: false
scenario_df
```

```{python}
#| label: fig-scenarios
#| fig-cap: "High-impact schedule yields the most cars"
#| echo: false
fig, ax = plt.subplots(figsize=(6.5, 3.8))
sc_plot = scenario_df.sort_values("Expected cars/week", ascending=True)
sns.barplot(data=sc_plot, x="Expected cars/week", y="Scenario", color="#4C78A8", ax=ax)
ax.set_xlabel("Expected cars fixed per week")
ax.set_ylabel("")
ax.set_title("Comparing simple weekly schedules")
for i, val in enumerate(sc_plot["Expected cars/week"]):
    ax.text(val + 2, i, f"{val:.0f}", va="center")
plt.tight_layout()
plt.show()
plt.close(fig)
```

Suggested schedule:

- High-impact focus: Shop 4 twice; Shops 2, 5, and 1 once each. Roughly 791 cars/week, ~10 more than an even rotation and ~51 more than never visiting.
- Need to see family at Shop 3? Swap one of the single-day stops for Shop 3; expect to give up ~4 cars/week versus the high-impact plan.

# Confidence and caveats

- Only 50 boss-present days total; Shops 2 and 4 have just 5 on-site days each, so their true lift could be lower or higher (note the wide error bars).
- Data are 250 past days; shocks like staffing changes or seasonality could change results. Re-check monthly as new data arrive.
- Revenue math scales with your price per car (not provided here). Multiply the lifts by your per-car margin to estimate dollars.

# Next steps to keep improving

- Track boss visits and cars fixed going forward; refresh the report each month.
- If you shift staffing or add promotions, note the date so we can explain any jumps or dips.
- Once more on-site days accumulate at Shops 2 and 4, rerun the bootstraps to tighten the intervals and refine the schedule.
